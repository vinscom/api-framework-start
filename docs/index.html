<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Vinay Kumar">
<title>API Framework Tutorial</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>API Framework Tutorial</h1>
<div class="details">
<span id="author" class="author">Vinay Kumar</span><br>
<span id="revnumber">version 0.1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_is_api_framework">What is API Framework ?</a>
<ul class="sectlevel2">
<li><a href="#_features">Features</a></li>
</ul>
</li>
<li><a href="#_simple_get_api">Simple GET API</a>
<ul class="sectlevel2">
<li><a href="#_create_maven_project_using_netbean">Create Maven Project using Netbean</a></li>
<li><a href="#_step_1_create_open_api_3_service_definition">Step 1: Create Open API 3 Service Definition</a></li>
<li><a href="#_step_2_write_api_request_handling">Step 2: Write API Request Handling</a></li>
<li><a href="#_step_3_write_test_to_test_our_service">Step 3: Write Test to test our service</a></li>
<li><a href="#_step_4_run_api_server">Step 4: Run API Server</a></li>
</ul>
</li>
<li><a href="#_simple_post_api">Simple POST API</a>
<ul class="sectlevel2">
<li><a href="#_step_1_extend_open_api_3_service_definition">Step 1: Extend Open API 3 Service Definition</a></li>
<li><a href="#_step_2_create_post_service_class">Step 2: Create POST Service Class</a></li>
<li><a href="#_step_3_update_get_service">Step 3: Update Get Service</a></li>
<li><a href="#_step_4_write_test_to_test_our_service">Step 4: Write Test to test our service</a></li>
<li><a href="#_step_4_run_api_server_2">Step 4: Run API Server</a></li>
</ul>
</li>
<li><a href="#_secure_api">Secure API</a>
<ul class="sectlevel2">
<li><a href="#_keycloak_setup">Keycloak Setup</a></li>
<li><a href="#_create_site_to_use_api_no_authentication">Create site to use API (No Authentication)</a></li>
<li><a href="#_create_site_to_use_api_only_after_authentication">Create site to use API only after authentication</a></li>
<li><a href="#_enable_api_authentication">Enable API Authentication</a></li>
<li><a href="#_run_server">Run Server</a></li>
<li><a href="#_test">Test</a></li>
</ul>
</li>
<li><a href="#_amazon_lambda_api">Amazon Lambda API</a>
<ul class="sectlevel2">
<li><a href="#_lambda_project_setup">Lambda Project Setup</a></li>
<li><a href="#_gradle_project_files">Gradle Project Files</a></li>
<li><a href="#_setup_lambda_function">Setup Lambda Function</a></li>
<li><a href="#_setup_api_gateway">Setup API Gateway</a></li>
<li><a href="#_deploy_api">Deploy API</a></li>
</ul>
</li>
<li><a href="#_docker_deployment">Docker Deployment</a>
<ul class="sectlevel2">
<li><a href="#_project_setup">Project Setup</a></li>
<li><a href="#_project_configuration_layer">Project configuration layer</a></li>
<li><a href="#_build_project_structure">Build Project Structure</a></li>
<li><a href="#_dockerfile">Dockerfile</a></li>
<li><a href="#_docker_image">Docker Image</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_what_is_api_framework">What is API Framework ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>API Framework is structured code/pattern/project template for you to write API based
system using Vertx Framework (<a href="http://vertx.io/" class="bare">http://vertx.io/</a>).</p>
</div>
<div class="paragraph">
<p>Idea is to provide structure to development project, so, that with minimum learning curve,
programmers can become productive. Understanding of Vertx and API Framework project
setup is enough to build complex application.</p>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Code and Configuration is completely separate.</p>
</li>
<li>
<p>Decoupled source code level dependencies between classes.</p>
</li>
<li>
<p>Configuration has layer concept to change configuration without changing original
configuration</p>
</li>
<li>
<p>Fully Reactive</p>
</li>
<li>
<p>Build is ready for serverless deployment (AWS Lambda).</p>
</li>
<li>
<p>Build is ready for Docker deployment</p>
</li>
<li>
<p>Zero installation. Copy paste and run. Easy cloud deployment.</p>
</li>
<li>
<p>Component based development and build for extension.</p>
</li>
<li>
<p>High performance (Based on Vertx).</p>
</li>
<li>
<p>Support all Vertx supported languages.</p>
</li>
<li>
<p>Open API 3 based API Definition.</p>
</li>
<li>
<p>Out of box Keycloak integration to create API Gateway.</p>
</li>
<li>
<p>Easy component based testing model.</p>
</li>
<li>
<p>Excellent implementation pattern repository to meet most of the use cases for any
complex project</p>
</li>
<li>
<p>Easy to learn</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For dependency and configuration management. We have used
<a href="https://vinscom.github.io/glue/">Glue</a> project.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_get_api">Simple GET API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will create simple session API to get list of dummy session.</p>
</div>
<div class="sect2">
<h3 id="_create_maven_project_using_netbean">Create Maven Project using Netbean</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Below steps are optional. You can clone
          <a href="https://github.com/vinscom/api-framework-start.git">API Framework Start</a>
          project and use <strong>tutorial-simple-get-api</strong> project.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Project Folder <strong>tutorial-simple-get-api</strong>. This will be used as base folder.</p>
</li>
<li>
<p>Create new project<br>
<span class="image"><img src="./images/netbean-project-wizard-1.png" alt="netbean project wizard 1"></span></p>
</li>
<li>
<p>Save project to <strong>tutorial-simple-get-api</strong> location<br>
<span class="image"><img src="./images/netbean-project-wizard-2.png" alt="netbean project wizard 2"></span></p>
</li>
<li>
<p>Add required dependencies to POM</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="lineno"> 1 </span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="lineno"> 2 </span>    <span class="tok-nt">&lt;groupId&gt;</span>in.erail<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno"> 3 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>api-framework<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 4 </span>    <span class="tok-nt">&lt;version&gt;</span>${api.framework.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno"> 5 </span><span class="tok-nt">&lt;/dependency&gt;</span>
<span class="lineno"> 6 </span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="lineno"> 7 </span>    <span class="tok-nt">&lt;groupId&gt;</span>in.erail<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno"> 8 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>api-framework<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 9 </span>    <span class="tok-nt">&lt;version&gt;</span>${api.framework.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">10 </span>    <span class="tok-nt">&lt;classifier&gt;</span>common-config<span class="tok-nt">&lt;/classifier&gt;</span>
<span class="lineno">11 </span>    <span class="tok-nt">&lt;type&gt;</span>zip<span class="tok-nt">&lt;/type&gt;</span>
<span class="lineno">12 </span><span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Additional project dependencies</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="lineno"> 1 </span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="lineno"> 2 </span>    <span class="tok-nt">&lt;groupId&gt;</span>io.vertx<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno"> 3 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>vertx-unit<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 4 </span>    <span class="tok-nt">&lt;version&gt;</span>3.5.1<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno"> 5 </span>    <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="lineno"> 6 </span><span class="tok-nt">&lt;/dependency&gt;</span>
<span class="lineno"> 7 </span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="lineno"> 8 </span>    <span class="tok-nt">&lt;groupId&gt;</span>junit<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno"> 9 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>junit<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">10 </span>    <span class="tok-nt">&lt;version&gt;</span>4.12<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">11 </span>    <span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="lineno">12 </span><span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create <strong>tutorial-simple-get-api/config-layers/common</strong> and
<strong>tutorial-simple-get-api/config-layers/test</strong> folder to store all configuration</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<strong>common</strong> configuration is for production use. <strong>test</strong> configuration can be
          used to add new or override any configuration during unit test
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create <strong>tutorial-simple-get-api/src/assembly/common-config.xml</strong></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="lineno"> 1 </span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="lineno"> 2 </span><span class="tok-nt">&lt;assembly</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2&quot;</span>
<span class="lineno"> 3 </span>          <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="lineno"> 4 </span>          <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2 http://maven.apache.org/xsd/assembly-1.1.2.xsd&quot;</span><span class="tok-nt">&gt;</span>
<span class="lineno"> 5 </span>    <span class="tok-nt">&lt;id&gt;</span>common-config<span class="tok-nt">&lt;/id&gt;</span>
<span class="lineno"> 6 </span>    <span class="tok-nt">&lt;formats&gt;</span>
<span class="lineno"> 7 </span>        <span class="tok-nt">&lt;format&gt;</span>zip<span class="tok-nt">&lt;/format&gt;</span>
<span class="lineno"> 8 </span>    <span class="tok-nt">&lt;/formats&gt;</span>
<span class="lineno"> 9 </span>    <span class="tok-nt">&lt;fileSets&gt;</span>
<span class="lineno">10 </span>        <span class="tok-nt">&lt;fileSet&gt;</span>
<span class="lineno">11 </span>            <span class="tok-nt">&lt;directory&gt;</span>${project.basedir}/config-layers/common<span class="tok-nt">&lt;/directory&gt;</span>
<span class="lineno">12 </span>            <span class="tok-nt">&lt;outputDirectory&gt;</span>/config<span class="tok-nt">&lt;/outputDirectory&gt;</span>
<span class="lineno">13 </span>        <span class="tok-nt">&lt;/fileSet&gt;</span>
<span class="lineno">14 </span>    <span class="tok-nt">&lt;/fileSets&gt;</span>
<span class="lineno">15 </span><span class="tok-nt">&lt;/assembly&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This configuration will make sure that your <strong>common-config</strong> config layers
is packed and installed as artefact in maven repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add plugins to Maven</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="lineno"> 1 </span><span class="tok-nt">&lt;plugin&gt;</span>
<span class="lineno"> 2 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>maven-assembly-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 3 </span>    <span class="tok-nt">&lt;version&gt;</span>2.6<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno"> 4 </span>    <span class="tok-nt">&lt;executions&gt;</span>
<span class="lineno"> 5 </span>        <span class="tok-nt">&lt;execution&gt;</span>
<span class="lineno"> 6 </span>            <span class="tok-nt">&lt;id&gt;</span>common-config<span class="tok-nt">&lt;/id&gt;</span>
<span class="lineno"> 7 </span>            <span class="tok-nt">&lt;phase&gt;</span>package<span class="tok-nt">&lt;/phase&gt;</span>
<span class="lineno"> 8 </span>            <span class="tok-nt">&lt;goals&gt;</span>
<span class="lineno"> 9 </span>                <span class="tok-nt">&lt;goal&gt;</span>single<span class="tok-nt">&lt;/goal&gt;</span>
<span class="lineno">10 </span>            <span class="tok-nt">&lt;/goals&gt;</span>
<span class="lineno">11 </span>            <span class="tok-nt">&lt;configuration&gt;</span>
<span class="lineno">12 </span>                <span class="tok-nt">&lt;outputDirectory&gt;</span>${project.build.directory}/build/config<span class="tok-nt">&lt;/outputDirectory&gt;</span>
<span class="lineno">13 </span>                <span class="tok-nt">&lt;descriptor&gt;</span>src/assembly/common-config.xml<span class="tok-nt">&lt;/descriptor&gt;</span>
<span class="lineno">14 </span>            <span class="tok-nt">&lt;/configuration&gt;</span>
<span class="lineno">15 </span>        <span class="tok-nt">&lt;/execution&gt;</span>
<span class="lineno">16 </span>    <span class="tok-nt">&lt;/executions&gt;</span>
<span class="lineno">17 </span><span class="tok-nt">&lt;/plugin&gt;</span>
<span class="lineno">18 </span><span class="tok-nt">&lt;plugin&gt;</span>
<span class="lineno">19 </span>    <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno">20 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">21 </span>    <span class="tok-nt">&lt;version&gt;</span>2.20.1<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">22 </span>    <span class="tok-nt">&lt;configuration&gt;</span>
<span class="lineno">23 </span>        <span class="tok-nt">&lt;argLine&gt;</span>-Dvertx.logger-delegate-factory-class-name=io.vertx.core.logging.Log4j2LogDelegateFactory -Dglue.layers=${settings.localRepository}/in/erail/api-framework/${api.framework.version}/api-framework-${api.framework.version}-common-config.zip,${project.basedir}/config-layers/common,${project.basedir}/config-layers/test<span class="tok-nt">&lt;/argLine&gt;</span>
<span class="lineno">24 </span>    <span class="tok-nt">&lt;/configuration&gt;</span>
<span class="lineno">25 </span><span class="tok-nt">&lt;/plugin&gt;</span>
<span class="lineno">26 </span><span class="tok-nt">&lt;plugin&gt;</span>
<span class="lineno">27 </span>    <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno">28 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>maven-dependency-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">29 </span>    <span class="tok-nt">&lt;version&gt;</span>2.10<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">30 </span>    <span class="tok-nt">&lt;executions&gt;</span>
<span class="lineno">31 </span>        <span class="tok-nt">&lt;execution&gt;</span>
<span class="lineno">32 </span>            <span class="tok-nt">&lt;id&gt;</span>copy-installed<span class="tok-nt">&lt;/id&gt;</span>
<span class="lineno">33 </span>            <span class="tok-nt">&lt;phase&gt;</span>install<span class="tok-nt">&lt;/phase&gt;</span>
<span class="lineno">34 </span>            <span class="tok-nt">&lt;goals&gt;</span>
<span class="lineno">35 </span>                <span class="tok-nt">&lt;goal&gt;</span>copy<span class="tok-nt">&lt;/goal&gt;</span>
<span class="lineno">36 </span>            <span class="tok-nt">&lt;/goals&gt;</span>
<span class="lineno">37 </span>            <span class="tok-nt">&lt;configuration&gt;</span>
<span class="lineno">38 </span>                <span class="tok-nt">&lt;artifactItems&gt;</span>
<span class="lineno">39 </span>                    <span class="tok-nt">&lt;artifactItem&gt;</span>
<span class="lineno">40 </span>                        <span class="tok-nt">&lt;groupId&gt;</span>in.erail<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno">41 </span>                        <span class="tok-nt">&lt;artifactId&gt;</span>api-framework<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">42 </span>                        <span class="tok-nt">&lt;version&gt;</span>${api.framework.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">43 </span>                        <span class="tok-nt">&lt;classifier&gt;</span>common-config<span class="tok-nt">&lt;/classifier&gt;</span>
<span class="lineno">44 </span>                        <span class="tok-nt">&lt;type&gt;</span>zip<span class="tok-nt">&lt;/type&gt;</span>
<span class="lineno">45 </span>                    <span class="tok-nt">&lt;/artifactItem&gt;</span>
<span class="lineno">46 </span>                <span class="tok-nt">&lt;/artifactItems&gt;</span>
<span class="lineno">47 </span>                <span class="tok-nt">&lt;outputDirectory&gt;</span>${project.build.directory}/build/config<span class="tok-nt">&lt;/outputDirectory&gt;</span>
<span class="lineno">48 </span>            <span class="tok-nt">&lt;/configuration&gt;</span>
<span class="lineno">49 </span>        <span class="tok-nt">&lt;/execution&gt;</span>
<span class="lineno">50 </span>        <span class="tok-nt">&lt;execution&gt;</span>
<span class="lineno">51 </span>            <span class="tok-nt">&lt;id&gt;</span>copy-dependencies<span class="tok-nt">&lt;/id&gt;</span>
<span class="lineno">52 </span>            <span class="tok-nt">&lt;phase&gt;</span>prepare-package<span class="tok-nt">&lt;/phase&gt;</span>
<span class="lineno">53 </span>            <span class="tok-nt">&lt;goals&gt;</span>
<span class="lineno">54 </span>                <span class="tok-nt">&lt;goal&gt;</span>copy-dependencies<span class="tok-nt">&lt;/goal&gt;</span>
<span class="lineno">55 </span>            <span class="tok-nt">&lt;/goals&gt;</span>
<span class="lineno">56 </span>            <span class="tok-nt">&lt;configuration&gt;</span>
<span class="lineno">57 </span>                <span class="tok-nt">&lt;outputDirectory&gt;</span>${project.build.directory}/build/${project.artifactId}-${project.version}-lib/<span class="tok-nt">&lt;/outputDirectory&gt;</span>
<span class="lineno">58 </span>                <span class="tok-nt">&lt;overWriteReleases&gt;</span>false<span class="tok-nt">&lt;/overWriteReleases&gt;</span>
<span class="lineno">59 </span>                <span class="tok-nt">&lt;overWriteSnapshots&gt;</span>false<span class="tok-nt">&lt;/overWriteSnapshots&gt;</span>
<span class="lineno">60 </span>                <span class="tok-nt">&lt;overWriteIfNewer&gt;</span>true<span class="tok-nt">&lt;/overWriteIfNewer&gt;</span>
<span class="lineno">61 </span>            <span class="tok-nt">&lt;/configuration&gt;</span>
<span class="lineno">62 </span>        <span class="tok-nt">&lt;/execution&gt;</span>
<span class="lineno">63 </span>    <span class="tok-nt">&lt;/executions&gt;</span>
<span class="lineno">64 </span><span class="tok-nt">&lt;/plugin&gt;</span>
<span class="lineno">65 </span><span class="tok-nt">&lt;plugin&gt;</span>
<span class="lineno">66 </span>    <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno">67 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>maven-jar-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">68 </span>    <span class="tok-nt">&lt;version&gt;</span>3.0.2<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">69 </span>    <span class="tok-nt">&lt;configuration&gt;</span>
<span class="lineno">70 </span>        <span class="tok-nt">&lt;outputDirectory&gt;</span>${project.build.directory}/build<span class="tok-nt">&lt;/outputDirectory&gt;</span>
<span class="lineno">71 </span>        <span class="tok-nt">&lt;archive&gt;</span>
<span class="lineno">72 </span>            <span class="tok-nt">&lt;manifest&gt;</span>
<span class="lineno">73 </span>                <span class="tok-nt">&lt;addClasspath&gt;</span>true<span class="tok-nt">&lt;/addClasspath&gt;</span>
<span class="lineno">74 </span>                <span class="tok-nt">&lt;classpathPrefix&gt;</span>${project.artifactId}-${project.version}-lib/<span class="tok-nt">&lt;/classpathPrefix&gt;</span>
<span class="lineno">75 </span>                <span class="tok-nt">&lt;mainClass&gt;</span>in.erail.glue.Boot<span class="tok-nt">&lt;/mainClass&gt;</span>
<span class="lineno">76 </span>            <span class="tok-nt">&lt;/manifest&gt;</span>
<span class="lineno">77 </span>        <span class="tok-nt">&lt;/archive&gt;</span>
<span class="lineno">78 </span>    <span class="tok-nt">&lt;/configuration&gt;</span>
<span class="lineno">79 </span><span class="tok-nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Argument Line</div>
<p>To pass correct layer parameters to Test, we use argLine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="lineno">1 </span><span class="tok-nt">&lt;plugin&gt;</span>
<span class="lineno">2 </span>    <span class="tok-nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno">3 </span>    <span class="tok-nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">4 </span>    <span class="tok-nt">&lt;version&gt;</span>2.20.1<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">5 </span>    <span class="tok-nt">&lt;configuration&gt;</span>
<span class="lineno">6 </span>        <span class="tok-nt">&lt;argLine&gt;</span>-Dvertx.logger-delegate-factory-class-name=io.vertx.core.logging.Log4j2LogDelegateFactory -Dglue.layers=${settings.localRepository}/in/erail/api-framework/${api.framework.version}/api-framework-${api.framework.version}-common-config.zip,${project.basedir}/config-layers/common,${project.basedir}/config-layers/test<span class="tok-nt">&lt;/argLine&gt;</span>
<span class="lineno">7 </span>    <span class="tok-nt">&lt;/configuration&gt;</span>
<span class="lineno">8 </span><span class="tok-nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vertx.logger-delegate-factory-class-name</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>io.vertx.core.logging.Log4j2LogDelegateFactory</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Enable Log4J based logging.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">glue.layers</p></td>
<td class="tableblock halign-left valign-top"><div><table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Layer</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${settings.localRepository}/in/erail/api-framework/1.0-SNAPSHOT/api-framework-1.0-SNAPSHOT-common-config.zip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Framework Configuration Layer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${project.basedir}/config-layers/common</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Our project configuration layer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${project.basedir}/config-layers/test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Our project test configuration layer. Any test specific configuration can be done in this
layer</p></td>
</tr>
</tbody>
</table></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>All configuration layers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Configuration layers are read in same order as defined in
argument. Layer configuration is read from left to right. Means, right configuration will
override left configuration, if same configuration is also present in right layer.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Configuration are managed at individual property level. Please refer to <strong>Glue</strong>
to understand how layers are merged.
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_create_open_api_3_service_definition">Step 1: Create Open API 3 Service Definition</h3>
<div class="paragraph">
<p>To make life easy, we have used <a href="https://studio.apicur.io">Apicurio</a> to create Open API 3
definition. Below is definition</p>
</div>
<div class="listingblock">
<div class="title">openapi3.json</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="lineno"> 1 </span><span class="tok-p">{</span>
<span class="lineno"> 2 </span>    <span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;3.0.0&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 3 </span>    <span class="tok-nt">&quot;info&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 4 </span>        <span class="tok-nt">&quot;title&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tutorial-api&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 5 </span>        <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;1.0.0&quot;</span>
<span class="lineno"> 6 </span>    <span class="tok-p">},</span>
<span class="lineno"> 7 </span>    <span class="tok-nt">&quot;paths&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 8 </span>        <span class="tok-nt">&quot;/session&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 9 </span>            <span class="tok-nt">&quot;get&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">10 </span>                <span class="tok-nt">&quot;summary&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Get all session messages&quot;</span><span class="tok-p">,</span>
<span class="lineno">11 </span>                <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Return all session messages&quot;</span><span class="tok-p">,</span>
<span class="lineno">12 </span>                <span class="tok-nt">&quot;operationId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API_SESSION_GET&quot;</span><span class="tok-p">,</span>
<span class="lineno">13 </span>                <span class="tok-nt">&quot;responses&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">14 </span>                    <span class="tok-nt">&quot;200&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">15 </span>                        <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Return all messages&quot;</span><span class="tok-p">,</span>
<span class="lineno">16 </span>                        <span class="tok-nt">&quot;content&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">17 </span>                            <span class="tok-nt">&quot;application/json&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">18 </span>                                <span class="tok-nt">&quot;schema&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">19 </span>                                    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;array&quot;</span><span class="tok-p">,</span>
<span class="lineno">20 </span>                                    <span class="tok-nt">&quot;items&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">21 </span>                                        <span class="tok-nt">&quot;$ref&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;#/components/schemas/message&quot;</span>
<span class="lineno">22 </span>                                    <span class="tok-p">}</span>
<span class="lineno">23 </span>                                <span class="tok-p">}</span>
<span class="lineno">24 </span>                            <span class="tok-p">}</span>
<span class="lineno">25 </span>                        <span class="tok-p">}</span>
<span class="lineno">26 </span>                    <span class="tok-p">}</span>
<span class="lineno">27 </span>                <span class="tok-p">}</span>
<span class="lineno">28 </span>            <span class="tok-p">}</span>
<span class="lineno">29 </span>        <span class="tok-p">}</span>
<span class="lineno">30 </span>    <span class="tok-p">},</span>
<span class="lineno">31 </span>    <span class="tok-nt">&quot;components&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">32 </span>        <span class="tok-nt">&quot;schemas&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">33 </span>            <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">34 </span>                <span class="tok-nt">&quot;title&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Root Type for message&quot;</span><span class="tok-p">,</span>
<span class="lineno">35 </span>                <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;The root of the message type&#39;s schema.&quot;</span><span class="tok-p">,</span>
<span class="lineno">36 </span>                <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;object&quot;</span><span class="tok-p">,</span>
<span class="lineno">37 </span>                <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">38 </span>                    <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">39 </span>                        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="lineno">40 </span>                    <span class="tok-p">},</span>
<span class="lineno">41 </span>                    <span class="tok-nt">&quot;time&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">42 </span>                        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="lineno">43 </span>                    <span class="tok-p">}</span>
<span class="lineno">44 </span>                <span class="tok-p">}</span>
<span class="lineno">45 </span>            <span class="tok-p">}</span>
<span class="lineno">46 </span>        <span class="tok-p">}</span>
<span class="lineno">47 </span>    <span class="tok-p">}</span>
<span class="lineno">48 </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our API will have single URL /session (like <a href="http://localhost:8888/v1/session" class="bare">http://localhost:8888/v1/session</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Remember API Session is not related to actual Vertx Web Session.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">GET</div>
<p>On get request, session API will return all session messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Each method requiring processing must have <strong>unique OperationId</strong>.
OperationId is used for processing request from method.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configure_api_framework_to_use_service_definition">Configure API Framework to use service definition</h4>
<div class="paragraph">
<p>Copy <strong>openapi3.json</strong> to <strong>config-layers/common/in/erail/route/openapi3.json</strong>. Now
API Framework is configured to handle API Request. Next step is to write code to handle
request.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_write_api_request_handling">Step 2: Write API Request Handling</h3>
<div class="paragraph">
<p>Basic request handling flow</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/uml/basic-request-handling.png" alt="basic request handling" width="570" height="445">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Request Processing (Step 1 and 6) is synchronous.  In case Service fails to response
within predefined time limit (/io/vertx/core/eventbus/DeliveryOptions.sendTimeout).
request is canceled and fail response is sent back.</p>
</li>
<li>
<p>For each operationId defined in Open API definition, a service is registered. Service
contains mapping of Operation Id and UniqueServiceId. Whenever request comes
it is converted into EventBus message and sent on UniqueServiceId (Steps 2-3).</p>
</li>
<li>
<p>Step 2-5 are asynchronous.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_handle_get_method_called_on_session_url">Handle GET method called on /session URL</h4>
<div class="sect4">
<h5 id="_create_service_class">Create Service Class</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">package</span> <span class="tok-nn">in.erail.tutorial</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.common.FrameworkConstants</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.service.RESTServiceImpl</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonArray</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonObject</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.reactivex.core.eventbus.Message</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SessionGetService</span> <span class="tok-kd">extends</span> <span class="tok-n">RESTServiceImpl</span> <span class="tok-o">{</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>  <span class="tok-kd">private</span> <span class="tok-n">JsonArray</span> <span class="tok-n">mSessions</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JsonArray</span><span class="tok-o">();</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>  <span class="tok-kd">public</span> <span class="tok-nf">SessionGetService</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">14 </span>    <span class="tok-n">mSessions</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;S1&quot;</span><span class="tok-o">);</span>
<span class="lineno">15 </span>    <span class="tok-n">mSessions</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;S2&quot;</span><span class="tok-o">);</span>
<span class="lineno">16 </span>    <span class="tok-n">mSessions</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;S3&quot;</span><span class="tok-o">);</span>
<span class="lineno">17 </span>    <span class="tok-n">mSessions</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;S4&quot;</span><span class="tok-o">);</span>
<span class="lineno">18 </span>    <span class="tok-n">mSessions</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;S5&quot;</span><span class="tok-o">);</span>
<span class="lineno">19 </span>  <span class="tok-o">}</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>  <span class="tok-nd">@Override</span>
<span class="lineno">22 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">process</span><span class="tok-o">(</span><span class="tok-n">Message</span><span class="tok-o">&lt;</span><span class="tok-n">JsonObject</span><span class="tok-o">&gt;</span> <span class="tok-n">pMessage</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>    <span class="tok-n">pMessage</span><span class="tok-o">.</span><span class="tok-na">reply</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JsonObject</span><span class="tok-o">().</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-n">FrameworkConstants</span><span class="tok-o">.</span><span class="tok-na">RoutingContext</span><span class="tok-o">.</span><span class="tok-na">Json</span><span class="tok-o">.</span><span class="tok-na">BODY</span><span class="tok-o">,</span> <span class="tok-n">getSessions</span><span class="tok-o">()));</span>
<span class="lineno">24 </span>  <span class="tok-o">}</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span>  <span class="tok-kd">public</span> <span class="tok-n">JsonArray</span> <span class="tok-nf">getSessions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">27 </span>    <span class="tok-k">return</span> <span class="tok-n">mSessions</span><span class="tok-o">;</span>
<span class="lineno">28 </span>  <span class="tok-o">}</span>
<span class="lineno">29 </span>
<span class="lineno">30 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setSessions</span><span class="tok-o">(</span><span class="tok-n">JsonArray</span> <span class="tok-n">pSessions</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">mSessions</span> <span class="tok-o">=</span> <span class="tok-n">pSessions</span><span class="tok-o">;</span>
<span class="lineno">32 </span>  <span class="tok-o">}</span>
<span class="lineno">33 </span>
<span class="lineno">34 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Service class must implement <code>in.erail.service.RESTService</code> interface. A helper class is
provided to ease development <code>in.erail.service.RESTServiceImpl</code></p>
</div>
<div class="paragraph">
<p>As parameter, Message Object provides JsonObject. JsonObject contains below fields</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains all request headers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pathParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains all request parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">queryStringParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains all query parameters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In case of POST request, contains body</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Reply JSON Object you can have below fields</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No headers are added</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Headers will be added to response header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response content is blank</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Body is sent in response</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statusCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response HTTP status</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_create_service_component">Create Service Component</h5>
<div class="paragraph">
<p>Create below Component configuration file and place it in
<strong>/config-layers/common/in/erail/tutorial/SessionGetService</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/tutorial/SessionGetService</span>
<span class="lineno">2 </span><span class="tok-na">$class</span><span class="tok-o">=</span><span class="tok-s">in.erail.tutorial.SessionGetService</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="tok-na">operationId</span><span class="tok-o">=</span><span class="tok-s">API_SESSION_GET</span>
<span class="lineno">5 </span><span class="tok-na">serviceUniqueId</span><span class="tok-o">=</span><span class="tok-s">API_SESSION_GET</span>
<span class="lineno">6 </span><span class="tok-na">vertx</span><span class="tok-o">=</span><span class="tok-s">/io/vertx/core/Vertx</span>
<span class="lineno">7 </span><span class="tok-na">enable</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="lineno">8 </span><span class="tok-na">log</span><span class="tok-o">=</span><span class="tok-s">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In above configuration, <code>operationId</code> and <code>serviceUniqueId</code> are same. But, you can give
<code>serviceUniqueId</code> different name, make sure that it is unique across all services.</p>
</div>
<div class="paragraph">
<p>Add service to <strong>OpenAPI3RouteBuilder</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/route/OpenAPI3RouteBuilder</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-na">services+</span><span class="tok-o">=</span><span class="tok-s">\</span>
<span class="lineno">4 </span><span class="tok-s">    /in/erail/tutorial/SessionGetService</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>OpenAPI3RouteBuilder</code> will make sure, that, request received on URL with
<code>operationId</code> as defined in <code>SessionService</code> component is forwarded to <code>serviceUniqueId</code>
component via EventBus.</p>
</div>
<div class="paragraph">
<p>Now, our API is ready to use. Lets create a test class to test our service.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_write_test_to_test_our_service">Step 3: Write Test to test our service</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">package</span> <span class="tok-nn">in.erail.tutorial</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.glue.Glue</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.server.Server</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonArray</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.Async</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.TestContext</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.junit.Timeout</span><span class="tok-o">;</span>
<span class="lineno">10 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.junit.VertxUnitRunner</span><span class="tok-o">;</span>
<span class="lineno">11 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.Rule</span><span class="tok-o">;</span>
<span class="lineno">12 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.Test</span><span class="tok-o">;</span>
<span class="lineno">13 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.runner.RunWith</span><span class="tok-o">;</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">VertxUnitRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="lineno">16 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SessionTest</span> <span class="tok-o">{</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>  <span class="tok-nd">@Rule</span>
<span class="lineno">19 </span>  <span class="tok-kd">public</span> <span class="tok-n">Timeout</span> <span class="tok-n">rule</span> <span class="tok-o">=</span> <span class="tok-n">Timeout</span><span class="tok-o">.</span><span class="tok-na">seconds</span><span class="tok-o">(</span><span class="tok-mi">2000</span><span class="tok-o">);</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">22 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testGetRequest</span><span class="tok-o">(</span><span class="tok-n">TestContext</span> <span class="tok-n">context</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>    <span class="tok-n">Async</span> <span class="tok-n">async</span> <span class="tok-o">=</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">async</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
<span class="lineno">25 </span>    <span class="tok-n">Server</span> <span class="tok-n">server</span> <span class="tok-o">=</span> <span class="tok-n">Glue</span><span class="tok-o">.</span><span class="tok-na">instance</span><span class="tok-o">().&lt;</span><span class="tok-n">Server</span><span class="tok-o">&gt;</span><span class="tok-n">resolve</span><span class="tok-o">(</span><span class="tok-s">&quot;/in/erail/server/Server&quot;</span><span class="tok-o">);</span>
<span class="lineno">26 </span>    <span class="tok-n">server</span>
<span class="lineno">27 </span>            <span class="tok-o">.</span><span class="tok-na">getVertx</span><span class="tok-o">()</span>
<span class="lineno">28 </span>            <span class="tok-o">.</span><span class="tok-na">createHttpClient</span><span class="tok-o">()</span>
<span class="lineno">29 </span>            <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">getHttpServerOptions</span><span class="tok-o">().</span><span class="tok-na">getPort</span><span class="tok-o">(),</span> <span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">getHttpServerOptions</span><span class="tok-o">().</span><span class="tok-na">getHost</span><span class="tok-o">(),</span> <span class="tok-s">&quot;/v1/session&quot;</span><span class="tok-o">)</span>
<span class="lineno">30 </span>            <span class="tok-o">.</span><span class="tok-na">handler</span><span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
<span class="lineno">31 </span>              <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">statusCode</span><span class="tok-o">(),</span> <span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">statusMessage</span><span class="tok-o">());</span>
<span class="lineno">32 </span>              <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">bodyHandler</span><span class="tok-o">((</span><span class="tok-n">event</span><span class="tok-o">)</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
<span class="lineno">33 </span>                <span class="tok-n">JsonArray</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">toJsonArray</span><span class="tok-o">();</span>
<span class="lineno">34 </span>                <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
<span class="lineno">35 </span>                <span class="tok-n">async</span><span class="tok-o">.</span><span class="tok-na">countDown</span><span class="tok-o">();</span>
<span class="lineno">36 </span>              <span class="tok-o">});</span>
<span class="lineno">37 </span>              <span class="tok-n">async</span><span class="tok-o">.</span><span class="tok-na">countDown</span><span class="tok-o">();</span>
<span class="lineno">38 </span>            <span class="tok-o">})</span>
<span class="lineno">39 </span>            <span class="tok-o">.</span><span class="tok-na">end</span><span class="tok-o">();</span>
<span class="lineno">40 </span>  <span class="tok-o">}</span>
<span class="lineno">41 </span>
<span class="lineno">42 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_run_api_server">Step 4: Run API Server</h3>
<div class="paragraph">
<p>After running maven install. You should have <em>build</em> folder inside target folder.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/uml/build-folder-structure.png" alt="build folder structure" width="392" height="109">
</div>
<div class="title">Figure 1. Build folder structure</div>
</div>
<div class="listingblock">
<div class="title">Run Server (Assuming you are inside build folder)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="lineno">1 </span>java <span class="tok-se">\</span>
<span class="lineno">2 </span>-Dvertx.logger-delegate-factory-class-name<span class="tok-o">=</span>io.vertx.core.logging.Log4j2LogDelegateFactory <span class="tok-se">\</span>
<span class="lineno">3 </span>-Dglue.layers<span class="tok-o">=</span><span class="tok-se">\</span>
<span class="lineno">4 </span>./config/api-framework-1.0-SNAPSHOT-common-config.zip,<span class="tok-se">\</span>
<span class="lineno">5 </span>./config/tutorial-simple-get-api-1.0-SNAPSHOT-common-config.zip <span class="tok-se">\</span>
<span class="lineno">6 </span>-jar tutorial-simple-get-api-1.0-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Test API</div>
<p>Go to command prompt</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="lineno">1 </span>curl http://localhost:8888/v1/session</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>["S1","S2","S3","S4","S5"]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_post_api">Simple POST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, we will extend last tutorial to create POST method on <strong>/session</strong> URL.
Using POST request, we will update session and using GET request we will get
all sessions.</p>
</div>
<div class="sect2">
<h3 id="_step_1_extend_open_api_3_service_definition">Step 1: Extend Open API 3 Service Definition</h3>
<div class="paragraph">
<p>We have extended Open API 3 definition created in last tutorial. We have added
post method.</p>
</div>
<div class="listingblock">
<div class="title">openapi3.json</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="lineno"> 1 </span><span class="tok-p">{</span>
<span class="lineno"> 2 </span>    <span class="tok-nt">&quot;openapi&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;3.0.0&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 3 </span>    <span class="tok-nt">&quot;info&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 4 </span>        <span class="tok-nt">&quot;title&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tutorial-api&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 5 </span>        <span class="tok-nt">&quot;version&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;1.0.0&quot;</span>
<span class="lineno"> 6 </span>    <span class="tok-p">},</span>
<span class="lineno"> 7 </span>    <span class="tok-nt">&quot;paths&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 8 </span>        <span class="tok-nt">&quot;/session&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 9 </span>            <span class="tok-nt">&quot;get&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">10 </span>                <span class="tok-nt">&quot;summary&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Get all session messages&quot;</span><span class="tok-p">,</span>
<span class="lineno">11 </span>                <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Return all session messages&quot;</span><span class="tok-p">,</span>
<span class="lineno">12 </span>                <span class="tok-nt">&quot;operationId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API_SESSION_GET&quot;</span><span class="tok-p">,</span>
<span class="lineno">13 </span>                <span class="tok-nt">&quot;responses&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">14 </span>                    <span class="tok-nt">&quot;200&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">15 </span>                        <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Return all messages&quot;</span><span class="tok-p">,</span>
<span class="lineno">16 </span>                        <span class="tok-nt">&quot;content&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">17 </span>                            <span class="tok-nt">&quot;application/json&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">18 </span>                                <span class="tok-nt">&quot;schema&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">19 </span>                                    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;array&quot;</span><span class="tok-p">,</span>
<span class="lineno">20 </span>                                    <span class="tok-nt">&quot;items&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">21 </span>                                        <span class="tok-nt">&quot;$ref&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;#/components/schemas/message&quot;</span>
<span class="lineno">22 </span>                                    <span class="tok-p">}</span>
<span class="lineno">23 </span>                                <span class="tok-p">}</span>
<span class="lineno">24 </span>                            <span class="tok-p">}</span>
<span class="lineno">25 </span>                        <span class="tok-p">}</span>
<span class="lineno">26 </span>                    <span class="tok-p">}</span>
<span class="lineno">27 </span>                <span class="tok-p">}</span>
<span class="lineno">28 </span>            <span class="tok-p">},</span>
<span class="lineno">29 </span>            <span class="tok-nt">&quot;post&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">30 </span>                <span class="tok-nt">&quot;summary&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Post message on session&quot;</span><span class="tok-p">,</span>
<span class="lineno">31 </span>                <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Post message on session&quot;</span><span class="tok-p">,</span>
<span class="lineno">32 </span>                <span class="tok-nt">&quot;operationId&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;API_SESSION_POST&quot;</span><span class="tok-p">,</span>
<span class="lineno">33 </span>                <span class="tok-nt">&quot;responses&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">34 </span>                    <span class="tok-nt">&quot;200&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">35 </span>                        <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Post Message&quot;</span><span class="tok-p">,</span>
<span class="lineno">36 </span>                        <span class="tok-nt">&quot;content&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">37 </span>                            <span class="tok-nt">&quot;application/json&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">38 </span>                                <span class="tok-nt">&quot;schema&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">39 </span>                                    <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="lineno">40 </span>                                <span class="tok-p">}</span>
<span class="lineno">41 </span>                            <span class="tok-p">}</span>
<span class="lineno">42 </span>                        <span class="tok-p">}</span>
<span class="lineno">43 </span>                    <span class="tok-p">}</span>
<span class="lineno">44 </span>                <span class="tok-p">},</span>
<span class="lineno">45 </span>                <span class="tok-nt">&quot;requestBody&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">46 </span>                    <span class="tok-nt">&quot;content&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">47 </span>                        <span class="tok-nt">&quot;application/json&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">48 </span>                            <span class="tok-nt">&quot;schema&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">49 </span>                                <span class="tok-nt">&quot;$ref&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;#/components/schemas/message&quot;</span>
<span class="lineno">50 </span>                            <span class="tok-p">}</span>
<span class="lineno">51 </span>                        <span class="tok-p">}</span>
<span class="lineno">52 </span>                    <span class="tok-p">},</span>
<span class="lineno">53 </span>                    <span class="tok-nt">&quot;required&quot;</span><span class="tok-p">:</span> <span class="tok-kc">true</span>
<span class="lineno">54 </span>                <span class="tok-p">}</span>
<span class="lineno">55 </span>            <span class="tok-p">}</span>
<span class="lineno">56 </span>        <span class="tok-p">}</span>
<span class="lineno">57 </span>    <span class="tok-p">},</span>
<span class="lineno">58 </span>    <span class="tok-nt">&quot;components&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">59 </span>        <span class="tok-nt">&quot;schemas&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">60 </span>            <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">61 </span>                <span class="tok-nt">&quot;title&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;Root Type for message&quot;</span><span class="tok-p">,</span>
<span class="lineno">62 </span>                <span class="tok-nt">&quot;description&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;The root of the message type&#39;s schema.&quot;</span><span class="tok-p">,</span>
<span class="lineno">63 </span>                <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;object&quot;</span><span class="tok-p">,</span>
<span class="lineno">64 </span>                <span class="tok-nt">&quot;properties&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">65 </span>                    <span class="tok-nt">&quot;message&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">66 </span>                        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="lineno">67 </span>                    <span class="tok-p">},</span>
<span class="lineno">68 </span>                    <span class="tok-nt">&quot;time&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno">69 </span>                        <span class="tok-nt">&quot;type&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;string&quot;</span>
<span class="lineno">70 </span>                    <span class="tok-p">}</span>
<span class="lineno">71 </span>                <span class="tok-p">}</span>
<span class="lineno">72 </span>            <span class="tok-p">}</span>
<span class="lineno">73 </span>        <span class="tok-p">}</span>
<span class="lineno">74 </span>    <span class="tok-p">}</span>
<span class="lineno">75 </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>POST : You can post data to session using post request.</p>
<div class="listingblock">
<div class="title">Post Data Format</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
  <span class="tok-nt">&quot;session&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;random&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>GET : On get request, session API will return all session messages.</p>
<div class="listingblock">
<div class="title">Get Data Format</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">[</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;session&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;random&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;session&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;random&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;session&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;random&quot;</span><span class="tok-p">},</span>
  <span class="tok-p">{</span><span class="tok-nt">&quot;session&quot;</span> <span class="tok-p">:</span> <span class="tok-s2">&quot;random&quot;</span><span class="tok-p">}</span>
<span class="tok-p">]</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Each method requiring processing must have <strong>unique OperationId</strong>.
OperationId is used for processing request from method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_post_service_class">Step 2: Create POST Service Class</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">package</span> <span class="tok-nn">in.erail.tutorial</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">com.google.common.base.Joiner</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kn">import</span> <span class="tok-nn">com.google.common.base.Splitter</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.common.FrameworkConstants</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.service.RESTServiceImpl</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonObject</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.reactivex.core.eventbus.Message</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.reactivex.core.shareddata.LocalMap</span><span class="tok-o">;</span>
<span class="lineno">10 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.List</span><span class="tok-o">;</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="tok-cm">/**</span>
<span class="lineno">13 </span><span class="tok-cm"> * Store session data in LocalMap.</span>
<span class="lineno">14 </span><span class="tok-cm"> */</span>
<span class="lineno">15 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SessionPostService</span> <span class="tok-kd">extends</span> <span class="tok-n">RESTServiceImpl</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span>  <span class="tok-nd">@Override</span>
<span class="lineno">18 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">process</span><span class="tok-o">(</span><span class="tok-n">Message</span><span class="tok-o">&lt;</span><span class="tok-n">JsonObject</span><span class="tok-o">&gt;</span> <span class="tok-n">pMessage</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>    <span class="tok-n">LocalMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">getVertx</span><span class="tok-o">().</span><span class="tok-na">sharedData</span><span class="tok-o">().</span><span class="tok-na">getLocalMap</span><span class="tok-o">(</span><span class="tok-s">&quot;data&quot;</span><span class="tok-o">);</span>
<span class="lineno">20 </span>    <span class="tok-n">String</span> <span class="tok-n">sessions</span> <span class="tok-o">=</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">getOrDefault</span><span class="tok-o">(</span><span class="tok-s">&quot;sessions&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">);</span>
<span class="lineno">21 </span>    <span class="tok-n">JsonObject</span> <span class="tok-n">paramSession</span> <span class="tok-o">=</span> <span class="tok-n">pMessage</span><span class="tok-o">.</span><span class="tok-na">body</span><span class="tok-o">().</span><span class="tok-na">getJsonObject</span><span class="tok-o">(</span><span class="tok-n">FrameworkConstants</span><span class="tok-o">.</span><span class="tok-na">RoutingContext</span><span class="tok-o">.</span><span class="tok-na">Json</span><span class="tok-o">.</span><span class="tok-na">BODY</span><span class="tok-o">);</span>
<span class="lineno">22 </span>    <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">items</span> <span class="tok-o">=</span> <span class="tok-n">Splitter</span><span class="tok-o">.</span><span class="tok-na">on</span><span class="tok-o">(</span><span class="tok-s">&quot;,&quot;</span><span class="tok-o">).</span><span class="tok-na">omitEmptyStrings</span><span class="tok-o">().</span><span class="tok-na">trimResults</span><span class="tok-o">().</span><span class="tok-na">splitToList</span><span class="tok-o">(</span><span class="tok-n">sessions</span> <span class="tok-o">+</span> <span class="tok-s">&quot;,&quot;</span> <span class="tok-o">+</span> <span class="tok-n">paramSession</span><span class="tok-o">.</span><span class="tok-na">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;session&quot;</span><span class="tok-o">));</span>
<span class="lineno">23 </span>    <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;sessions&quot;</span><span class="tok-o">,</span> <span class="tok-n">Joiner</span><span class="tok-o">.</span><span class="tok-na">on</span><span class="tok-o">(</span><span class="tok-s">&quot;,&quot;</span><span class="tok-o">).</span><span class="tok-na">join</span><span class="tok-o">(</span><span class="tok-n">items</span><span class="tok-o">));</span>
<span class="lineno">24 </span>    <span class="tok-n">pMessage</span><span class="tok-o">.</span><span class="tok-na">reply</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JsonObject</span><span class="tok-o">());</span>
<span class="lineno">25 </span>  <span class="tok-o">}</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_create_service_component_2">Create Service Component</h4>
<div class="paragraph">
<p>Create below Component configuration file and place it at
<strong>config-layers/common/in/erail/tutorial/SessionPostService.properties</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/tutorial/SessionPostService</span>
<span class="lineno">2 </span><span class="tok-na">$class</span><span class="tok-o">=</span><span class="tok-s">in.erail.tutorial.SessionPostService</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="tok-na">operationId</span><span class="tok-o">=</span><span class="tok-s">API_SESSION_POST</span>
<span class="lineno">5 </span><span class="tok-na">serviceUniqueId</span><span class="tok-o">=</span><span class="tok-s">API_SESSION_POST</span>
<span class="lineno">6 </span><span class="tok-na">vertx</span><span class="tok-o">=</span><span class="tok-s">/io/vertx/core/Vertx</span>
<span class="lineno">7 </span><span class="tok-na">enable</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="lineno">8 </span><span class="tok-na">log</span><span class="tok-o">=</span><span class="tok-s">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add service to <strong>OpenAPI3RouteBuilder</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/route/OpenAPI3RouteBuilder</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="tok-na">services+</span><span class="tok-o">=</span><span class="tok-s">\</span>
<span class="lineno">4 </span><span class="tok-s">    /in/erail/tutorial/SessionGetService,\</span>
<span class="lineno">5 </span><span class="tok-s">    /in/erail/tutorial/SessionPostService</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_update_get_service">Step 3: Update Get Service</h3>
<div class="paragraph">
<p>We will update Get service to return sessions stored by post request. Instead of updating
existing <strong>SessionGetService</strong> class. We will create new class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">package</span> <span class="tok-nn">in.erail.tutorial</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonArray</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.reactivex.core.shareddata.LocalMap</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span><span class="tok-kn">import</span> <span class="tok-nn">java.util.Arrays</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SessionGetServiceV2</span> <span class="tok-kd">extends</span> <span class="tok-n">SessionGetService</span> <span class="tok-o">{</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>  <span class="tok-nd">@Override</span>
<span class="lineno">10 </span>  <span class="tok-kd">public</span> <span class="tok-n">JsonArray</span> <span class="tok-nf">getSessions</span><span class="tok-o">()</span> <span class="tok-o">{</span>
<span class="lineno">11 </span>    <span class="tok-n">LocalMap</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">getVertx</span><span class="tok-o">().</span><span class="tok-na">sharedData</span><span class="tok-o">().&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">String</span><span class="tok-o">&gt;</span><span class="tok-n">getLocalMap</span><span class="tok-o">(</span><span class="tok-s">&quot;data&quot;</span><span class="tok-o">);</span>
<span class="lineno">12 </span>    <span class="tok-n">String</span> <span class="tok-n">sessions</span> <span class="tok-o">=</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">getOrDefault</span><span class="tok-o">(</span><span class="tok-s">&quot;sessions&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;&quot;</span><span class="tok-o">);</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>    <span class="tok-n">JsonArray</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JsonArray</span><span class="tok-o">();</span>
<span class="lineno">15 </span>    <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">stream</span><span class="tok-o">(</span><span class="tok-n">sessions</span><span class="tok-o">.</span><span class="tok-na">split</span><span class="tok-o">(</span><span class="tok-s">&quot;,&quot;</span><span class="tok-o">)).</span><span class="tok-na">forEach</span><span class="tok-o">((</span><span class="tok-n">s</span><span class="tok-o">)</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
<span class="lineno">16 </span>      <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">s</span><span class="tok-o">);</span>
<span class="lineno">17 </span>    <span class="tok-o">});</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>    <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
<span class="lineno">20 </span>  <span class="tok-o">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use our new class, we have to simply change component class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/tutorial/SessionGetService</span>
<span class="lineno">2 </span><span class="hll"><span class="tok-na">$class</span><span class="tok-o">=</span><span class="tok-s">in.erail.tutorial.SessionGetServiceV2</span>
</span><span class="lineno">3 </span>
<span class="lineno">4 </span><span class="tok-na">operationId</span><span class="tok-o">=</span><span class="tok-s">API_SESSION_GET</span>
<span class="lineno">5 </span><span class="tok-na">serviceUniqueId</span><span class="tok-o">=</span><span class="tok-s">API_SESSION_GET</span>
<span class="lineno">6 </span><span class="tok-na">vertx</span><span class="tok-o">=</span><span class="tok-s">/io/vertx/core/Vertx</span>
<span class="lineno">7 </span><span class="tok-na">enable</span><span class="tok-o">=</span><span class="tok-s">true</span>
<span class="lineno">8 </span><span class="tok-na">log</span><span class="tok-o">=</span><span class="tok-s">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our API is ready to use. Lets create a test class to test our service.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_write_test_to_test_our_service">Step 4: Write Test to test our service</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="lineno"> 1 </span><span class="tok-kn">package</span> <span class="tok-nn">in.erail.tutorial</span><span class="tok-o">;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-kn">import</span> <span class="tok-nn">com.google.common.net.HttpHeaders</span><span class="tok-o">;</span>
<span class="lineno"> 4 </span><span class="tok-kn">import</span> <span class="tok-nn">com.google.common.net.MediaType</span><span class="tok-o">;</span>
<span class="lineno"> 5 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.glue.Glue</span><span class="tok-o">;</span>
<span class="lineno"> 6 </span><span class="tok-kn">import</span> <span class="tok-nn">in.erail.server.Server</span><span class="tok-o">;</span>
<span class="lineno"> 7 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonArray</span><span class="tok-o">;</span>
<span class="lineno"> 8 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.core.json.JsonObject</span><span class="tok-o">;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.Async</span><span class="tok-o">;</span>
<span class="lineno">11 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.TestContext</span><span class="tok-o">;</span>
<span class="lineno">12 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.junit.Timeout</span><span class="tok-o">;</span>
<span class="lineno">13 </span><span class="tok-kn">import</span> <span class="tok-nn">io.vertx.ext.unit.junit.VertxUnitRunner</span><span class="tok-o">;</span>
<span class="lineno">14 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.Rule</span><span class="tok-o">;</span>
<span class="lineno">15 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.Test</span><span class="tok-o">;</span>
<span class="lineno">16 </span><span class="tok-kn">import</span> <span class="tok-nn">org.junit.runner.RunWith</span><span class="tok-o">;</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">VertxUnitRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="lineno">19 </span><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SessionTest</span> <span class="tok-o">{</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span>  <span class="tok-nd">@Rule</span>
<span class="lineno">22 </span>  <span class="tok-kd">public</span> <span class="tok-n">Timeout</span> <span class="tok-n">rule</span> <span class="tok-o">=</span> <span class="tok-n">Timeout</span><span class="tok-o">.</span><span class="tok-na">seconds</span><span class="tok-o">(</span><span class="tok-mi">2000</span><span class="tok-o">);</span>
<span class="lineno">23 </span>
<span class="lineno">24 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">25 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testPostRequest</span><span class="tok-o">(</span><span class="tok-n">TestContext</span> <span class="tok-n">context</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>    <span class="tok-n">Async</span> <span class="tok-n">async</span> <span class="tok-o">=</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">async</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">);</span>
<span class="lineno">28 </span>
<span class="lineno">29 </span>    <span class="tok-n">Server</span> <span class="tok-n">server</span> <span class="tok-o">=</span> <span class="tok-n">Glue</span><span class="tok-o">.</span><span class="tok-na">instance</span><span class="tok-o">().&lt;</span><span class="tok-n">Server</span><span class="tok-o">&gt;</span><span class="tok-n">resolve</span><span class="tok-o">(</span><span class="tok-s">&quot;/in/erail/server/Server&quot;</span><span class="tok-o">);</span>
<span class="lineno">30 </span>    <span class="tok-n">String</span> <span class="tok-n">content</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">JsonObject</span><span class="tok-o">().</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;session&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;random&quot;</span><span class="tok-o">).</span><span class="tok-na">toString</span><span class="tok-o">();</span>
<span class="lineno">31 </span>
<span class="lineno">32 </span>    <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-mi">5</span><span class="tok-o">;</span> <span class="tok-o">++</span><span class="tok-n">i</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">33 </span>      <span class="tok-n">server</span>
<span class="lineno">34 </span>              <span class="tok-o">.</span><span class="tok-na">getVertx</span><span class="tok-o">()</span>
<span class="lineno">35 </span>              <span class="tok-o">.</span><span class="tok-na">createHttpClient</span><span class="tok-o">()</span>
<span class="lineno">36 </span>              <span class="tok-o">.</span><span class="tok-na">post</span><span class="tok-o">(</span><span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">getHttpServerOptions</span><span class="tok-o">().</span><span class="tok-na">getPort</span><span class="tok-o">(),</span> <span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">getHttpServerOptions</span><span class="tok-o">().</span><span class="tok-na">getHost</span><span class="tok-o">(),</span> <span class="tok-s">&quot;/v1/session&quot;</span><span class="tok-o">)</span>
<span class="lineno">37 </span>              <span class="tok-o">.</span><span class="tok-na">putHeader</span><span class="tok-o">(</span><span class="tok-n">HttpHeaders</span><span class="tok-o">.</span><span class="tok-na">CONTENT_TYPE</span><span class="tok-o">,</span> <span class="tok-n">MediaType</span><span class="tok-o">.</span><span class="tok-na">JSON_UTF_8</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">())</span>
<span class="lineno">38 </span>              <span class="tok-o">.</span><span class="tok-na">putHeader</span><span class="tok-o">(</span><span class="tok-n">HttpHeaders</span><span class="tok-o">.</span><span class="tok-na">CONTENT_LENGTH</span><span class="tok-o">,</span> <span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">(</span><span class="tok-n">content</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">()))</span>
<span class="lineno">39 </span>              <span class="tok-o">.</span><span class="tok-na">handler</span><span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
<span class="lineno">40 </span>                <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">statusCode</span><span class="tok-o">(),</span> <span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">statusMessage</span><span class="tok-o">());</span>
<span class="lineno">41 </span>                <span class="tok-n">async</span><span class="tok-o">.</span><span class="tok-na">countDown</span><span class="tok-o">();</span>
<span class="lineno">42 </span>              <span class="tok-o">})</span>
<span class="lineno">43 </span>              <span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-n">content</span><span class="tok-o">)</span>
<span class="lineno">44 </span>              <span class="tok-o">.</span><span class="tok-na">end</span><span class="tok-o">();</span>
<span class="lineno">45 </span>    <span class="tok-o">}</span>
<span class="lineno">46 </span>
<span class="lineno">47 </span>  <span class="tok-o">}</span>
<span class="lineno">48 </span>
<span class="lineno">49 </span>  <span class="tok-nd">@Test</span>
<span class="lineno">50 </span>  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testGetRequest</span><span class="tok-o">(</span><span class="tok-n">TestContext</span> <span class="tok-n">context</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">51 </span>
<span class="lineno">52 </span>    <span class="tok-n">Async</span> <span class="tok-n">async</span> <span class="tok-o">=</span> <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">async</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">);</span>
<span class="lineno">53 </span>    <span class="tok-n">Server</span> <span class="tok-n">server</span> <span class="tok-o">=</span> <span class="tok-n">Glue</span><span class="tok-o">.</span><span class="tok-na">instance</span><span class="tok-o">().&lt;</span><span class="tok-n">Server</span><span class="tok-o">&gt;</span><span class="tok-n">resolve</span><span class="tok-o">(</span><span class="tok-s">&quot;/in/erail/server/Server&quot;</span><span class="tok-o">);</span>
<span class="lineno">54 </span>    <span class="tok-n">server</span>
<span class="lineno">55 </span>            <span class="tok-o">.</span><span class="tok-na">getVertx</span><span class="tok-o">()</span>
<span class="lineno">56 </span>            <span class="tok-o">.</span><span class="tok-na">createHttpClient</span><span class="tok-o">()</span>
<span class="lineno">57 </span>            <span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">getHttpServerOptions</span><span class="tok-o">().</span><span class="tok-na">getPort</span><span class="tok-o">(),</span> <span class="tok-n">server</span><span class="tok-o">.</span><span class="tok-na">getHttpServerOptions</span><span class="tok-o">().</span><span class="tok-na">getHost</span><span class="tok-o">(),</span> <span class="tok-s">&quot;/v1/session&quot;</span><span class="tok-o">)</span>
<span class="lineno">58 </span>            <span class="tok-o">.</span><span class="tok-na">handler</span><span class="tok-o">(</span><span class="tok-n">response</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
<span class="lineno">59 </span>              <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">statusCode</span><span class="tok-o">(),</span> <span class="tok-mi">200</span><span class="tok-o">,</span> <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">statusMessage</span><span class="tok-o">());</span>
<span class="lineno">60 </span>              <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">bodyHandler</span><span class="tok-o">((</span><span class="tok-n">event</span><span class="tok-o">)</span> <span class="tok-o">-&gt;</span> <span class="tok-o">{</span>
<span class="lineno">61 </span>                <span class="tok-n">JsonArray</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">toJsonArray</span><span class="tok-o">();</span>
<span class="lineno">62 </span>                <span class="tok-n">context</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-n">data</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
<span class="lineno">63 </span>                <span class="tok-n">async</span><span class="tok-o">.</span><span class="tok-na">countDown</span><span class="tok-o">();</span>
<span class="lineno">64 </span>              <span class="tok-o">});</span>
<span class="lineno">65 </span>              <span class="tok-n">async</span><span class="tok-o">.</span><span class="tok-na">countDown</span><span class="tok-o">();</span>
<span class="lineno">66 </span>            <span class="tok-o">})</span>
<span class="lineno">67 </span>            <span class="tok-o">.</span><span class="tok-na">end</span><span class="tok-o">();</span>
<span class="lineno">68 </span>  <span class="tok-o">}</span>
<span class="lineno">69 </span>
<span class="lineno">70 </span><span class="tok-o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_run_api_server_2">Step 4: Run API Server</h3>
<div class="paragraph">
<p>After running maven install. You should have <em>build</em> folder inside target folder.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/uml/build-folder-structure.png" alt="build folder structure" width="399" height="109">
</div>
<div class="title">Figure 2. Build folder structure</div>
</div>
<div class="listingblock">
<div class="title">Run Server (Assuming you are inside build folder)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="lineno">1 </span>java <span class="tok-se">\</span>
<span class="lineno">2 </span>-Dvertx.logger-delegate-factory-class-name<span class="tok-o">=</span>io.vertx.core.logging.Log4j2LogDelegateFactory <span class="tok-se">\</span>
<span class="lineno">3 </span>-Dglue.layers<span class="tok-o">=</span><span class="tok-se">\</span>
<span class="lineno">4 </span>./config/api-framework-1.0-SNAPSHOT-common-config.zip,<span class="tok-se">\</span>
<span class="lineno">5 </span>./config/tutorial-simple-post-api-1.0-SNAPSHOT-common-config.zip <span class="tok-se">\</span>
<span class="lineno">6 </span>-jar tutorial-simple-post-api-1.0-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Test API</div>
<p>Go to command prompt</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="lineno">1 </span><span class="tok-c1">#Post data</span>
<span class="lineno">2 </span>curl -XPOST -H <span class="tok-s2">&quot;Content-type: application/json&quot;</span> -d <span class="tok-s1">&#39;{&quot;session&quot; : &quot;message1&quot;}&#39;</span> <span class="tok-s1">&#39;http://localhost:8888/v1/session&#39;</span>
<span class="lineno">3 </span>curl -XPOST -H <span class="tok-s2">&quot;Content-type: application/json&quot;</span> -d <span class="tok-s1">&#39;{&quot;session&quot; : &quot;message2&quot;}&#39;</span> <span class="tok-s1">&#39;http://localhost:8888/v1/session&#39;</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="tok-c1">#Get data</span>
<span class="lineno">6 </span>curl http://localhost:8888/v1/session</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>["message1","message2"]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secure_api">Secure API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In previous tutorials, we created, Get and Post Session APIs. Now, in this tutorial we will
use Open Id Connect pattern to secure both APIs.</p>
</div>
<div class="paragraph">
<p>Things we will do in this tutorial:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup and configure Keycloak instance</p>
</li>
<li>
<p>Create small website to showcase authenticated API working</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_keycloak_setup">Keycloak Setup</h3>
<div class="sect3">
<h4 id="_install">Install</h4>
<div class="paragraph">
<p>To reduce complexity of installation. We will run Keycloak in docker.
Depending on your OS, install <a href="https://www.docker.com/community-edition#/download">Docker</a></p>
</div>
<div class="paragraph">
<p>Create docker compose file at tutorial-secure-api/docker</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yml"><span></span><span class="lineno"> 1 </span>version: &#39;3.2&#39;
<span class="lineno"> 2 </span>services:
<span class="lineno"> 3 </span>    openidserver:
<span class="lineno"> 4 </span>        image: jboss/keycloak:3.4.3.Final
<span class="lineno"> 5 </span>        hostname: openidserver
<span class="lineno"> 6 </span>        expose:
<span class="lineno"> 7 </span>            - 8080
<span class="lineno"> 8 </span>        ports:
<span class="lineno"> 9 </span>            - &quot;8080:8080&quot;
<span class="lineno">10 </span>        environment:
<span class="lineno">11 </span>            - KEYCLOAK_USER=admin
<span class="lineno">12 </span>            - KEYCLOAK_PASSWORD=RM99Q330Tg
<span class="lineno">13 </span>            - KEYCLOAK_LOGLEVEL=DEBUG
<span class="lineno">14 </span>            - DB_VENDOR=MYSQL
<span class="lineno">15 </span>            - MYSQL_DATABASE=keycloak
<span class="lineno">16 </span>            - MYSQL_USER=keycloak
<span class="lineno">17 </span>            - MYSQL_PASSWORD=8HVcBB5FMv
<span class="lineno">18 </span>            - MYSQL_PORT_3306_TCP_ADDR=mysql
<span class="lineno">19 </span>            - MYSQL_PORT_3306_TCP_PORT=3306
<span class="lineno">20 </span>        depends_on:
<span class="lineno">21 </span>            - mysql
<span class="lineno">22 </span>    mysql:
<span class="lineno">23 </span>        image: mysql:5.7
<span class="lineno">24 </span>        hostname: mysql
<span class="lineno">25 </span>        expose:
<span class="lineno">26 </span>            - 3306
<span class="lineno">27 </span>        volumes:
<span class="lineno">28 </span>            - ./data/mysql/keycloak/data:/var/lib/mysql
<span class="lineno">29 </span>        environment:
<span class="lineno">30 </span>            - MYSQL_ROOT_PASSWORD=KgWVt9jCUq
<span class="lineno">31 </span>            - MYSQL_DATABASE=keycloak
<span class="lineno">32 </span>            - MYSQL_USER=keycloak
<span class="lineno">33 </span>            - MYSQL_PASSWORD=8HVcBB5FMv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run (From inside tutorial-secure-api/docker)</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="lineno">1 </span>docker-compose up</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/home-screen.png" alt="home screen">
</div>
<div class="title">Figure 3. Once started, you can access Keycloak at http://localhost:8080/auth/admin/</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">Configuration</h4>
<div class="paragraph">
<p>Got to <a href="http://localhost:8080/auth/admin/" class="bare">http://localhost:8080/auth/admin/</a> and login using <strong>admin</strong> and use password as provided
in docker-compose.yml</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step1-client-home.png" alt="step1 client home">
</div>
</div>
<div class="sect4">
<h5 id="_add_open_id_connect_client">Add Open ID Connect Client</h5>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step2-add-client.png" alt="step2 add client">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_update_settings">Update Settings</h5>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step3-client-settings-part1.png" alt="step3 client settings part1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step3-client-settings-part2.png" alt="step3 client settings part2">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_generate_keycloak_configuration_json">Generate Keycloak configuration JSON</h5>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step3-client-installation.png" alt="step3 client installation">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="lineno"> 1 </span><span class="tok-p">{</span>
<span class="lineno"> 2 </span>  <span class="tok-nt">&quot;realm&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;master&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 3 </span>  <span class="tok-nt">&quot;auth-server-url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/auth&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 4 </span>  <span class="tok-nt">&quot;ssl-required&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;external&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 5 </span>  <span class="tok-nt">&quot;resource&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tutorial-secure-api-client&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 6 </span>  <span class="tok-nt">&quot;credentials&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 7 </span>    <span class="tok-nt">&quot;secret&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;92867ec4-d23b-4dc8-8910-c80bdc0a8b36&quot;</span>
<span class="lineno"> 8 </span>  <span class="tok-p">},</span>
<span class="lineno"> 9 </span>  <span class="tok-nt">&quot;confidential-port&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
<span class="lineno">10 </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_add_strong_realm_public_key_strong_to_above_configuration">Add <strong>realm-public-key</strong> to above configuration</h6>
<div class="paragraph">
<p>Go to Realm settings</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step4-realm-keys.png" alt="step4 realm keys">
</div>
</div>
<div class="paragraph">
<p>And press <strong>Public Key</strong> button to see <strong>realm-public-key</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step5-realm-public-key.png" alt="step5 realm public key">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="lineno"> 1 </span><span class="tok-p">{</span>
<span class="lineno"> 2 </span>  <span class="tok-nt">&quot;realm&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;master&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 3 </span>  <span class="tok-nt">&quot;auth-server-url&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;http://localhost:8080/auth&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 4 </span>  <span class="tok-nt">&quot;realm-public-key&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAweS+2PCSDDfGzgXPSElqFFMddkGkNU3Vb44V2TTcsyl9S02RPR+e0QRttKcn17lLzgRBs65ayxlHN5Mi/n5UD/B5Xvtz+uVCwDJ9ltQSCNUsvcuf0NI3SBNu1G23xrOv+rBmyDprykorjUUqoQi4ss/VuqN2S2R+toeB5gRIVcul/xaGDOLHVPJOqWkvMjNO1NCMVAneeBsqru8/EZP6lbipBORvIkPJ8kinkTaoFdEgnDQeyICgg6ONYb5CCQY0B5vvTXMsTePAD0etCJUZbcVfT2p31KL8I3wpIkptL2AtTn1XpKpEm8guax/80CUmSCf5KhfQe39YNt5FC2OLjQIDAQAB&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 5 </span>  <span class="tok-nt">&quot;ssl-required&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;external&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 6 </span>  <span class="tok-nt">&quot;resource&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;tutorial-secure-api-client&quot;</span><span class="tok-p">,</span>
<span class="lineno"> 7 </span>  <span class="tok-nt">&quot;credentials&quot;</span><span class="tok-p">:</span> <span class="tok-p">{</span>
<span class="lineno"> 8 </span>    <span class="tok-nt">&quot;secret&quot;</span><span class="tok-p">:</span> <span class="tok-s2">&quot;92867ec4-d23b-4dc8-8910-c80bdc0a8b36&quot;</span>
<span class="lineno"> 9 </span>  <span class="tok-p">},</span>
<span class="lineno">10 </span>  <span class="tok-nt">&quot;confidential-port&quot;</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
<span class="lineno">11 </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy above configuration to <strong>/io/vertx/ext/auth/oauth2/keyCloakConfig.json</strong> in
<strong>common</strong> configuration layer.</p>
</div>
<div class="paragraph">
<p>Now our Keyclock server is fully setup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<strong>realm-public-key</strong> and <strong>secret</strong> value will depend on your installation.
So, don&#8217;t simply copy-paste above JSON.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To know all URLs supported by Realm got to
<a href="http://localhost:8080/auth/realms/master/.well-known/openid-configuration">OpenID Endpoint Configuration</a>.
This information can be accessed from Realm Settings &#8594; General &#8594; Endpoint
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_role_for_each_api_operation">Add Role for each API Operation</h5>
<div class="paragraph">
<p>In Open API 3 definition, we have Operation Id for each operation. Corresponding to each
operation, we will create Role in Keycloak. To access any operation, user must have
role assigned to him in Keycloak.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Group</th>
<th class="tableblock halign-left valign-top">Role(=Operation Id)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Full Access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API_SESSION_GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client will be able to make GET request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API_SESSION_POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client will be able to make POST request</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Lets create Role for our APIs. Go to <strong>Roles</strong> section</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add new role</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step11-role-home.png" alt="step11 role home">
</div>
</div>
</li>
<li>
<p>Create <strong>API_SESSION_GET</strong> and <strong>API_SESSION_POST</strong> roles</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step12-role-create.png" alt="step12 role create">
</div>
<div class="title">Figure 4. API_SESSION_POST Role example</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step13-role-all.png" alt="step13 role all">
</div>
<div class="title">Figure 5. All role list</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_add_group">Add Group</h5>
<div class="paragraph">
<p>Though roles can be assigned to user directly. <strong>Group</strong> concept is nice way of managing
user groups and roles associated to groups are automatically inherited by its users.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add group</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step14-group-home.png" alt="step14 group home">
</div>
</div>
</li>
<li>
<p>Create group</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step15-group-create.png" alt="step15 group create">
</div>
</div>
</li>
<li>
<p>Group and role mapping</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step16-group-role-mapping.png" alt="step16 group role mapping">
</div>
<div class="title">Figure 6. Add both <strong>API_SESSION_GET</strong> and <strong>API_SESSION_POST</strong> roles</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_add_user">Add User</h5>
<div class="paragraph">
<p>We will use this user to login</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Users</strong> section</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step6-users-home.png" alt="step6 users home">
</div>
</div>
</li>
<li>
<p>Click on Add user</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step7-add-user.png" alt="step7 add user">
</div>
</div>
</li>
<li>
<p>Update password</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step8-change-password-1.png" alt="step8 change password 1">
</div>
</div>
</li>
<li>
<p>Confirm</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step8-change-password-2.png" alt="step8 change password 2">
</div>
</div>
</li>
<li>
<p>Add user to group</p>
<div class="imageblock">
<div class="content">
<img src="./images/keycloak/step9-user-groups.png" alt="step9 user groups">
</div>
<div class="title">Figure 7. Add user to <strong>Full Access</strong> group</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_update_hosts_file">Update Hosts file</h5>
<div class="paragraph">
<p>As our API Server and Keycloak are running on same system with same
domain name (localhost). Keycloak authentication won&#8217;t work correctly. To fix this we
will run Keycloak in its own domain</p>
</div>
<div class="paragraph">
<p>Depending on your OS. Update hosts file with below entry.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Server</th>
<th class="tableblock halign-left valign-top">IP</th>
<th class="tableblock halign-left valign-top">Domain</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keycloak Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">127.0.0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openidserver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain name for keycloak server</p></td>
</tr>
</tbody>
</table>
<div class="literalblock">
<div class="title">Example hosts file content</div>
<div class="content">
<pre>127.0.0.1   openidserver</pre>
</div>
</div>
<div class="paragraph">
<p>Now you will access site on <strong>localhost</strong> and Keycloak on <strong>openidserver</strong> domain.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_site_to_use_api_no_authentication">Create site to use API (No Authentication)</h3>
<div class="paragraph">
<p>Ideally, you will run only API on API Framework and content will be delivered from
somewhere else like below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/uml/simple-api-and-content-infra-setup.png" alt="simple api and content infra setup" width="305" height="267">
</div>
</div>
<div class="paragraph">
<p>To keep things simple, for the time been, we will delivery static content from our API
server. And overall setup will look as show below</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/uml/simple-local-infa-setup.png" alt="simple local infa setup" width="309" height="314">
</div>
</div>
<div class="paragraph">
<p>Vertx already support static content handling. To enable static content handling,
add static content handler to <strong>/in/erail/server/Server</strong> component</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/server/Server</span>
<span class="lineno">2 </span><span class="tok-na">routerBuilder+</span><span class="tok-o">=</span><span class="tok-s">\</span>
<span class="lineno">3 </span><span class="tok-s">    /content/=/in/erail/route/StaticContentRouteBuillder</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Above configuration will make sure that any content in
<strong>/src/main/resources/webroot</strong> is available at <a href="http://localhost:8888/content/" class="bare">http://localhost:8888/content/</a> url.</p>
</div>
<div class="paragraph">
<p>A dummy site is already provided <strong>/src/main/resources/webroot</strong>. You can submit
and fetch session updates using API. To access page, goto
<a href="http://localhost:8888/content/index.html" class="bare">http://localhost:8888/content/index.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_create_site_to_use_api_only_after_authentication">Create site to use API only after authentication</h3>
<div class="paragraph">
<p>Same location where we provided Index.html. We have provided Indexsecure.html
file. This file is exactly same as Index. But, has Login line with URL.
To access page, goto <a href="http://localhost:8888/content/indexsecure.html" class="bare">http://localhost:8888/content/indexsecure.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_enable_api_authentication">Enable API Authentication</h3>
<div class="paragraph">
<p>We have already done all the configuration as part of Keycloak setup. Simple enable
<strong>OAuth2AuthInstance</strong> component  at <strong>/io/vertx/ext/auth/oauth2/OAuth2AuthInstance</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_run_server">Run Server</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="lineno">1 </span>java <span class="tok-se">\</span>
<span class="lineno">2 </span>-Dvertx.logger-delegate-factory-class-name<span class="tok-o">=</span>io.vertx.core.logging.Log4j2LogDelegateFactory <span class="tok-se">\</span>
<span class="lineno">3 </span>-Dglue.layers<span class="tok-o">=</span><span class="tok-se">\</span>
<span class="lineno">4 </span>./config/api-framework-1.0-SNAPSHOT-common-config.zip,<span class="tok-se">\</span>
<span class="lineno">5 </span>./config/tutorial-secure-api-1.0-SNAPSHOT-common-config.zip <span class="tok-se">\</span>
<span class="lineno">6 </span>-jar tutorial-secure-api-1.0-SNAPSHOT.jar</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test">Test</h3>
<div class="paragraph">
<p>If <strong>OAuth2AuthInstance</strong> component is disabled, then you should be able to use API
without authentication. If <strong>OAuth2AuthInstance</strong> component is enable, then without login,
you can&#8217;t access APIs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_amazon_lambda_api">Amazon Lambda API</h2>
<div class="sectionbody">
<div class="quoteblock">
<div class="title">Serverless Architectures</div>
<blockquote>
Serverless architectures refer to applications that significantly depend on third-party
services (knows as Backend as a Service or "BaaS") or on custom code that&#8217;s run in
ephemeral containers (Function as a Service or "FaaS"), the best known vendor host of
which currently is AWS Lambda.
</blockquote>
<div class="attribution">
&#8212; Mike Roberts<br>
<cite>https://martinfowler.com/articles/serverless.html</cite>
</div>
</div>
<div class="paragraph">
<p>API Framework allows you to effortlessly run your API code as Lambda function in
AWS ecosystem. In this tutorial, we will setup, Amazon API Gateway to access Session
GET API (created as part of previous tutorial) and Amazon Lambda to execute Session
GET logic.</p>
</div>
<div class="sect2">
<h3 id="_lambda_project_setup">Lambda Project Setup</h3>
<div class="paragraph">
<p>We will be extending
<a href="https://docs.aws.amazon.com/lambda/latest/dg/create-deployment-pkg-zip-java.html">Amazon Lambda Example Project</a>
to run <strong>Session GET API</strong>. Example Lambda project is setup in Gradle. So, instead of
Maven, we will be using Gradle Project for this tutorial.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gradle_project_files">Gradle Project Files</h3>
<div class="sect3">
<h4 id="_settings_gradle">settings.gradle</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="lineno">1 </span><span class="tok-n">rootProject</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-s1">&#39;tutorial-amazon-lambda&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file only contain project name.</p>
</div>
</div>
<div class="sect3">
<h4 id="_build_gradle">build.gradle</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="groovy"><span></span><span class="lineno"> 1 </span><span class="tok-n">apply</span> <span class="tok-nl">plugin:</span> <span class="tok-s1">&#39;java&#39;</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-n">repositories</span> <span class="tok-o">{</span>
<span class="lineno"> 4 </span>    <span class="tok-n">mavenCentral</span><span class="tok-o">()</span>
<span class="lineno"> 5 </span>    <span class="tok-n">mavenLocal</span><span class="tok-o">()</span>
<span class="lineno"> 6 </span><span class="tok-o">}</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="tok-n">dependencies</span> <span class="tok-o">{</span>
<span class="lineno"> 9 </span>    <span class="tok-c1">//Only Required Dependecies</span>
<span class="lineno">10 </span>    <span class="tok-n">compile</span> <span class="tok-s1">&#39;in.erail:api-framework-amazon-lambda:2.1&#39;</span>
<span class="lineno">11 </span>    <span class="tok-n">compile</span> <span class="tok-s1">&#39;in.erail:api-framework-amazon-lambda:2.1:common-config@zip&#39;</span>
<span class="lineno">12 </span>    <span class="tok-c1">//Already developed Session GET API Tutorial project</span>
<span class="lineno">13 </span>    <span class="tok-n">compile</span> <span class="tok-s1">&#39;in.erail:tutorial-simple-get-api:1.0-SNAPSHOT&#39;</span>
<span class="lineno">14 </span>    <span class="tok-c1">//Session GET API Tutorial project configuration</span>
<span class="lineno">15 </span>    <span class="tok-n">compile</span> <span class="tok-s1">&#39;in.erail:tutorial-simple-get-api:1.0-SNAPSHOT:common-config@zip&#39;</span>
<span class="lineno">16 </span><span class="tok-o">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="tok-n">task</span> <span class="tok-nf">buildZip</span><span class="tok-o">(</span><span class="tok-nl">type:</span> <span class="tok-n">Zip</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">19 </span>    <span class="tok-n">from</span> <span class="tok-n">compileJava</span>
<span class="lineno">20 </span>    <span class="tok-n">from</span> <span class="tok-n">processResources</span>
<span class="lineno">21 </span>    <span class="tok-nf">into</span><span class="tok-o">(</span><span class="tok-s1">&#39;lib&#39;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
<span class="lineno">22 </span>        <span class="tok-n">from</span> <span class="tok-n">configurations</span><span class="tok-o">.</span><span class="tok-na">runtime</span>
<span class="lineno">23 </span>    <span class="tok-o">}</span>
<span class="lineno">24 </span><span class="tok-o">}</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span><span class="tok-n">build</span><span class="tok-o">.</span><span class="tok-na">dependsOn</span> <span class="tok-n">buildZip</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>api-framework-amazon-lambda</strong> is the required dependency. As we have already done
all the work to write session api as part of <strong>Simple GET API</strong> tutorial. Instead of writing
any new code, we have included <strong>Simple GET API</strong> project as dependency in our project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gradle_properties">gradle.properties</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#Compilation only for Java 1.8</span>
<span class="lineno">2 </span><span class="tok-c1">#org.gradle.java.home=/Library/Java/JavaVirtualMachines/jdk1.8.0_152.jdk/Contents/Home</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, Amazon Lambda only supports Java 1.8. In case you are having problem
compiling project (Because you have installed Java 1.9). You can specifically JDK here.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_build">Create Build</h4>
<div class="listingblock">
<div class="title">Run</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="lineno">1 </span>gradle buildZip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your Lambda deployment package will get created at
<code>build/distributions/tutorial-amazon-lambda.zip</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup_lambda_function">Setup Lambda Function</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to AWS Management Console</p>
</li>
<li>
<p>Goto Lambda</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-lambda/aws-lambda-home.png" alt="aws lambda home">
</div>
</div>
<div class="paragraph">
<p>Create lambda function using <strong>Create Function</strong></p>
</div>
</li>
<li>
<p>Create Function Screen</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-lambda/aws-lambda-author-from-scratch.png" alt="aws lambda author from scratch">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong> : handleProcess</p>
</li>
<li>
<p><strong>Runtime</strong> : Java 8</p>
</li>
<li>
<p><strong>Role</strong> :  Create role from template.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Role Name</strong> : BasicPermission</p>
</li>
<li>
<p><strong>Policy templates</strong> : Basic Edge Lambda permissions</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Function Code</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-lambda/aws-lambda-config.png" alt="aws lambda config">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Function Package</strong> : Upload <em>tutorial-amazon-lambda.zip</em> file ( Amazon recommends
S3 for uploading larger then 10MB file. For simplicity, just upload file directly from here.)</p>
</li>
<li>
<p><strong>Handle</strong> : Enter <em>in.erail.amazon.lambda.AWSLambda</em> (Only class package
and class name. No handle)</p>
</li>
<li>
<p><strong>Environment Variable</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>JAVA_TOOL_OPTIONS</strong>  :  <em>-Dservice=/in/erail/tutorial/SessionGetService -Dglue.layers=./lib/api-framework-1.0-SNAPSHOT-common-config.zip,./lib/tutorial-simple-get-api-1.0-SNAPSHOT-common-config.zip,./lib/api-framework-amazon-lambda-1.0-SNAPSHOT-common-config.zip -Dvertx.cacheDirBase=/tmp/vertx-cache -Dvertx.logger-delegate-factory-class-name=io.vertx.core.logging.Log4j2LogDelegateFactory -Dlog4j.configurationFile=./log4j2.xml</em></p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java System Properties</th>
<th class="tableblock halign-left valign-top">Env Variable</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dservice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/in/erail/tutorial/SessionGetService</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service component path. You can pass value as Java System property or as Environment variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dglue.layers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GLUE_LAYERS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">./lib/api-framework-1.0-SNAPSHOT-common-config.zip,./lib/tutorial-simple-get-api-1.0-SNAPSHOT-common-config.zip,./lib/api-framework-amazon-lambda-1.0-SNAPSHOT-common-config.zip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Layers to include. Ordered left to right.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dvertx.cacheDirBase</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tmp/vertx-cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard Vertx option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dvertx.logger-delegate-factory-class-name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.vertx.core.logging.Log4j2LogDelegateFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard Vertx option</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dlog4j.configurationFile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">./log4j2.xml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard Vertx option</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Basic Settings</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-lambda/aws-lambda-basic-settings.png" alt="aws lambda basic settings">
</div>
</div>
<div class="paragraph">
<p>Ensure you set memory to 256MB minimum. Or else you will get memory out of exception</p>
</div>
</li>
<li>
<p>Create Test Event</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-lambda/aws-lambda-test.png" alt="aws lambda test">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Event Template</strong> : API Gateway AWS Proxy</p>
</li>
<li>
<p><strong>Event Name</strong> : SessionGETAPITestEvent</p>
</li>
<li>
<p><strong>Event Body</strong> : Though body is POST message. Keep it as it is. Lambda function gets
everything as JSON Object. Mapping between correct URL and Method type and
Lambda function is managed at API Gateway level. Here we just want to test our
Lambda function.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Test Result</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-lambda/aws-lambda-test-result.png" alt="aws lambda test result">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_setup_api_gateway">Setup API Gateway</h3>
<div class="paragraph">
<p>Now our Lambda function is setup. Lets use Amazon API Gateway to expose our API.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create API</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-home.png" alt="amazon api gateway home">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>API name</strong> : <em>Tutorial Session Get API</em></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
API Gateway supports Swagger 2.0. API Framework supports Open API 3
specifications. As Open API 3 specification is becoming industry standard.
Expectation is that Amazon will start supporting Open API 3 in future. Till then,
you will have to create API manually.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create Resource</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-create-resource.png" alt="amazon api gateway create resource">
</div>
</div>
<div class="paragraph">
<p>Our API will be accessible on <em>/session</em> URL.</p>
</div>
</li>
<li>
<p>Configure Resource</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-resource-config.png" alt="amazon api gateway resource config">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Name</strong> : <em>session</em></p>
</li>
<li>
<p><strong>Resource Path</strong> : URL <em>/session</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Create Action</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-get-action.png" alt="amazon api gateway get action">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GET Action</strong> : Create GET action. Configure action as per image.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Save Action</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-get-action-save.png" alt="amazon api gateway get action save">
</div>
</div>
</li>
<li>
<p>Method Setup</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-get-action-created.png" alt="amazon api gateway get action created">
</div>
</div>
<div class="paragraph">
<p>Final API setup</p>
</div>
</li>
<li>
<p>Test API</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-get-action-test.png" alt="amazon api gateway get action test">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Our API is working!!!</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_api">Deploy API</h3>
<div class="paragraph">
<p>Now, lets make our API public. To make our API public, we will have to create stage.
Stage will give us unique URL through which we can access our API (If you want, you can
also map this stage to your custom domain) .</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As this is tutorial, we are not using any type of authentication. Please
make sure you have right level of access in any stage API.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy API</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-deploy-api.png" alt="amazon api gateway deploy api">
</div>
</div>
</li>
<li>
<p>Create new stage</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-deploy-api-config.png" alt="amazon api gateway deploy api config">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Deployment Stage</strong> : <em>New Stage</em></p>
</li>
<li>
<p><strong>Stage Name</strong> : <em>tutorial</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Stage Home</p>
<div class="imageblock">
<div class="content">
<img src="./images/amazon-api-gateway/amazon-api-gateway-stage-home.png" alt="amazon api gateway stage home">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Using <strong>Invoka URL</strong> we can access our API. To access API use below URL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://bhpdtkdfek.execute-api.us-east-2.amazonaws.com/tutorial/session</pre>
</div>
</div>
<div class="paragraph">
<p>Done!!!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker_deployment">Docker Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, we will package our project created as part of <strong>Simple POST API</strong> tutorial
into Docker image.</p>
</div>
<div class="sect2">
<h3 id="_project_setup">Project Setup</h3>
<div class="paragraph">
<p>We will use Maven project to create build ready for creation of Docker image.
If you have done <strong>Simple POST API</strong>. Then you will find that our POM.xml is almost
exactly same.</p>
</div>
<div class="paragraph">
<p>In docker project, we will generate three config files.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>API Framework configuration file</p>
</li>
<li>
<p>Post API Tutorial configuration file</p>
</li>
<li>
<p>Docker configuration file (This project)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We have update artefact section. So, after build, you will find 3 configuration files in
<em>build/config</em> folder</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="lineno"> 1 </span><span class="tok-nt">&lt;artifactItems&gt;</span>
<span class="lineno"> 2 </span>    <span class="tok-nt">&lt;artifactItem&gt;</span>
<span class="lineno"> 3 </span>        <span class="tok-nt">&lt;groupId&gt;</span>in.erail<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno"> 4 </span>        <span class="tok-nt">&lt;artifactId&gt;</span>api-framework<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 5 </span>        <span class="tok-nt">&lt;version&gt;</span>${api.framework.version}<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno"> 6 </span>        <span class="tok-nt">&lt;classifier&gt;</span>common-config<span class="tok-nt">&lt;/classifier&gt;</span>
<span class="lineno"> 7 </span>        <span class="tok-nt">&lt;type&gt;</span>zip<span class="tok-nt">&lt;/type&gt;</span>
<span class="lineno"> 8 </span>    <span class="tok-nt">&lt;/artifactItem&gt;</span>
<span class="lineno"> 9 </span>    <span class="tok-nt">&lt;artifactItem&gt;</span>
<span class="lineno">10 </span>        <span class="tok-nt">&lt;groupId&gt;</span>in.erail<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="lineno">11 </span>        <span class="tok-nt">&lt;artifactId&gt;</span>tutorial-simple-post-api<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="lineno">12 </span>        <span class="tok-nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="tok-nt">&lt;/version&gt;</span>
<span class="lineno">13 </span>        <span class="tok-nt">&lt;classifier&gt;</span>common-config<span class="tok-nt">&lt;/classifier&gt;</span>
<span class="lineno">14 </span>        <span class="tok-nt">&lt;type&gt;</span>zip<span class="tok-nt">&lt;/type&gt;</span>
<span class="lineno">15 </span>    <span class="tok-nt">&lt;/artifactItem&gt;</span>
<span class="lineno">16 </span><span class="tok-nt">&lt;/artifactItems&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_configuration_layer">Project configuration layer</h3>
<div class="paragraph">
<p>Docker configuration layer contains only single configuration file <strong>server.properties</strong>.
This file overrides <em>host</em> property. By default, <em>host</em> property is configured to use
<em>localhost</em>. This creates problem where URLs are not accessible from outside Docker
container (from Host machine). Using <em>0.0.0.0</em>, we make sure that URL is accessible
from outside also (from Host machine).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ini"><span></span><span class="lineno">1 </span><span class="tok-c1">#/in/erail/server/Server</span>
<span class="lineno">2 </span><span class="tok-c1">#If host is localhost, Server is not accessible from outside contaner.</span>
<span class="lineno">3 </span><span class="tok-na">host</span><span class="tok-o">=</span><span class="tok-s">0.0.0.0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_project_structure">Build Project Structure</h3>
<div class="paragraph">
<p>After build your maven project, you will find below structure in target/build folder</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/uml/docker-build-folder-structure.png" alt="docker build folder structure" width="399" height="124">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dockerfile">Dockerfile</h3>
<div class="paragraph">
<p>Docker file configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="docker"><span></span><span class="lineno"> 1 </span><span class="tok-k">FROM</span><span class="tok-s"> openjdk:8-jdk</span>
<span class="lineno"> 2 </span>
<span class="lineno"> 3 </span><span class="tok-c"># Vertx cache</span>
<span class="lineno"> 4 </span><span class="tok-k">ENV</span><span class="tok-s"> VERTX_OPTS -Dvertx.cacheDirBase=/tmp/</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="tok-c"># Set the location of the verticles</span>
<span class="lineno"> 7 </span><span class="tok-k">ENV</span><span class="tok-s"> VERTICLE_HOME /usr/verticle</span>
<span class="lineno"> 8 </span>
<span class="lineno"> 9 </span>COPY ./target/build <span class="tok-nv">$VERTICLE_HOME</span>
<span class="lineno">10 </span><span class="tok-k">WORKDIR</span><span class="tok-s"> $VERTICLE_HOME</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="tok-k">ENTRYPOINT</span><span class="tok-s"> [&quot;sh&quot;,&quot;-c&quot;]</span>
<span class="lineno">13 </span><span class="tok-k">CMD</span><span class="tok-s"> [&quot;java \</span>
<span class="lineno">14 </span>        -Dglue.layers<span class="tok-o">=</span>./config/api-framework-1.0-SNAPSHOT-common-config.zip,./config/tutorial-simple-post-api-1.0-SNAPSHOT-common-config.zip,./config/tutorial-docker-1.0-SNAPSHOT-common-config.zip <span class="tok-se">\</span>
<span class="lineno">15 </span>        -jar tutorial-docker-1.0-SNAPSHOT.jar<span class="tok-s2">&quot;]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For your reference, more configuration is provided to you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="docker"><span></span><span class="lineno"> 1 </span><span class="tok-c"># Reference Config:</span>
<span class="lineno"> 2 </span><span class="tok-c"># 1. Debug enable</span>
<span class="lineno"> 3 </span><span class="tok-c"># 2. Vertx and Hazelcast JMX enable</span>
<span class="lineno"> 4 </span><span class="tok-c"># 3. G1 garbage collector</span>
<span class="lineno"> 5 </span><span class="tok-c"># 4. Set Vertx Logging to use Log4J</span>
<span class="lineno"> 6 </span><span class="tok-c">#</span>
<span class="lineno"> 7 </span><span class="tok-c">#===============================================================================</span>
<span class="lineno"> 8 </span><span class="tok-c"># NOTE:</span>
<span class="lineno"> 9 </span><span class="tok-c"># $RMI_PORT : RMI Port on which you want to access JMX. Map this port to Host</span>
<span class="lineno">10 </span><span class="tok-c">#             Port also.</span>
<span class="lineno">11 </span><span class="tok-c"># $HOST : Host IP Address. IP Address of your machine, not, docker</span>
<span class="lineno">12 </span><span class="tok-c">#===============================================================================</span>
<span class="lineno">13 </span><span class="tok-c">#</span>
<span class="lineno">14 </span><span class="tok-c">#CMD [&quot;java \</span>
<span class="lineno">15 </span><span class="tok-c">#        -Xmx1g \</span>
<span class="lineno">16 </span><span class="tok-c">#        -Xms1g \</span>
<span class="lineno">17 </span><span class="tok-c">#        -XX:+UseG1GC \</span>
<span class="lineno">18 </span><span class="tok-c">#        -Dvertx.logger-delegate-factory-class-name=io.vertx.core.logging.Log4j2LogDelegateFactory \</span>
<span class="lineno">19 </span><span class="tok-c">#        -Dhazelcast.jmx=true \</span>
<span class="lineno">20 </span><span class="tok-c">#        -Dcom.sun.management.jmxremote \</span>
<span class="lineno">21 </span><span class="tok-c">#        -Dcom.sun.management.jmxremote.port=$RMI_PORT \</span>
<span class="lineno">22 </span><span class="tok-c">#        -Dcom.sun.management.jmxremote.rmi.port=$RMI_PORT \</span>
<span class="lineno">23 </span><span class="tok-c">#        -Djava.rmi.server.hostname=$HOST \</span>
<span class="lineno">24 </span><span class="tok-c">#        -Dcom.sun.management.jmxremote.ssl=false \</span>
<span class="lineno">25 </span><span class="tok-c">#        -Dcom.sun.management.jmxremote.authenticate=false \</span>
<span class="lineno">26 </span><span class="tok-c">#        -Dglue.layers=./config/api-framework-1.0-SNAPSHOT-common-config.zip,./config/tutorial-simple-post-api-1.0-SNAPSHOT-common-config.zip,./config/tutorial-docker-1.0-SNAPSHOT-common-config.zip \</span>
<span class="lineno">27 </span><span class="tok-c">#        -agentlib:jdwp=transport=dt_socket,address=$DEBUG_PORT,server=y,suspend=n \</span>
<span class="lineno">28 </span><span class="tok-c">#        -jar tutorial-docker-1.0-SNAPSHOT.jar&quot;]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker_image">Docker Image</h3>
<div class="paragraph">
<p>To create image you will need to install Docker. Depending on your OS, please install
docker from <a href="https://www.docker.com/">Docker.com</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Image</p>
<div class="listingblock">
<div class="title">Run command in same folder where <strong>Dockerfile</strong> is present.</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="lineno">1 </span>docker build -t tutorial-docker .</code></pre>
</div>
</div>
</li>
<li>
<p>Run Image</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sh"><span></span><span class="lineno">1 </span>docker run --name tutorial-docker-test -p <span class="tok-m">8888</span>:8888 tutorial-docker</code></pre>
</div>
</div>
</li>
<li>
<p>To test, use same test commands as used in <strong>Simple POST API</strong> tutorial.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You docker image is ready with name <strong>tutorial-docker</strong>!!!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Image created is only present in your system. To publish image, please refer
to  Docker documentation.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.1<br>
Last updated 2018-01-14 13:57:37 GMT
</div>
</div>
</body>
</html>